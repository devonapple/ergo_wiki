# How to set up and configure a full Ergo node

This tutorial explains how to install and configure an Ergo node.

## Node security

There are a few important aspects of node usage that your wallet and money's safety depends on:
* An Ergo node requires storing security-critical parameters in the configuration file. You should never make this file public.
* An Ergo node provides a REST API for interacting with the built-in wallet. Sensitive API methods require a security token, which should never be sent over untrusted channels.

## Setting up the environment

To run an Ergo node you need JRE version >= 8 to be installed. One way to install it is to use [Oracle implementation of Java](https://www.oracle.com/technetwork/java/javase/downloads/index.html).

## Setting up an Ergo node

When the environment is ready it is time to download the latest [Ergo client release](https://github.com/ergoplatform/ergo/releases/) and create a configuration file.
Note that instead of downloading the jar, you can clone the repository and create the jar yourself using [SBT](https://www.scala-sbt.org/) by issuing the `sbt assembly` command.

All configuration parameters are described in the [default configuration file](https://github.com/ergoplatform/ergo/blob/master/src/main/resources/reference.conf). In your configuration file, you only need to rewrite parameters that you want to change from the default values. As an example, you can check the [sample configuration file](https://github.com/ergoplatform/ergo/blob/master/src/main/resources/nodeTestnet/application.conf) for the latest testnet which contains only the important parameters. Note that when using the latter file, you must remove or comment out the following lines in the file: 

```
testMnemonic = ...
testKeysQty = ...
```

Let ºs now take a few important steps:

1. **Setting an API key**: For configuring the wallet, you must first configure the `apiKeyHash` parameter in the node configuration file as described [here](https://github.com/ergoplatform/ergo/wiki/Ergo-REST-API#setting-an-api-key). In particular, the following line in the configuration file needs to be edited:

   `scorex.restApi.apiKeyHash = "replace_this_with_your_unique_api_key_hash"`

   The value should be the hex-encoded Blake2b256 hash of your secret phrase that will be used to authenticate your API requests. You can use this [script](https://gist.github.com/oskin1/704ef3fba8d40bb1e7691919bf1e9cf9/) or any other script to calculate blake2b hash for this purpose. The secret phrase can be any random string but please ensure that this remains secret and is not sent to any untrusted services. 

   The following REST API endpoint also provides a (non-protected) method to compute this:

   [`/utils/hashBlake2b`](http://127.0.0.1:9052/swagger#/utils/hashBlake2b)

2. **Initialize the wallet**: This step requires an API key to have been set as described above. When running the node for the first time, the wallet needs to be [initialized](https://github.com/ergoplatform/ergo/wiki/Wallet-configuration#using-the-wallet-for-the-first-time) via the REST API. Two options are available for this: 
    * Initialize it from scratch (seed will be generated by the node) by making a POST request to `/wallet/init` with data `body: {"pass": "123", "mnemonicPass": "abc"}` (Note: don't forget to save the mnemonic phrase that the node responds with. The parameter `mnemonicPass` in request body is optional and is used for protecting the mnemonic phrase).
    * Restore the wallet from an existing seed. You will have to provide your mnemonic phrase When using this option. This is done by making a POST request to `/wallet/restore` with data `body: {"pass": "123", "mnemonic": "abandon abandon ...", "mnemonicPass": "abc"}` (Note: the `mnemonicPass` field is required only in case your mnemonic phrase was protected by an additional password at creation).

3. **Unlock the wallet**: After the wallet is initialized it needs to be [unlocked](https://github.com/ergoplatform/ergo/wiki/Wallet-configuration#unlocking-the-wallet) by making a POST request to `/wallet/unlock` with data `body: {"pass": "123"}`. (Note: use the password you had chosen at initialization stage)

Details of wallet are described [here](https://github.com/ergoplatform/ergo/wiki/Wallet-configuration).

## Running the Ergo node

To run a node from `ergo-assembly-<version>.jar` binary and `ergo.conf` configuration file execute:
```
$ java -jar -Xmx3G ergo-assembly-<version>.jar ergo.conf
```

To make sure the node is running, open [`127.0.0.1:9052/info`](http://127.0.0.1:9052/info) in your browser. This will return general information about your node. 

## Using the REST API
The node provides a REST API as described [here](https://github.com/ergoplatform/ergo/wiki/Ergo-REST-API).

You can use Swagger to perform API requests by visiting [`127.0.0.1:9052/swagger`](http://127.0.0.1:9052/swagger). Full API specification (in OpenAPI format) is available [here](https://github.com/ergoplatform/ergo/blob/master/src/main/resources/api/openapi.yaml). To access protected API routes, provide your secret phrase (created above) in the request headers `[api_key, Content-Type]`, or click the `Authorize` button in Swagger and enter your secret phrase there.

## Turning off console printing

By default, the Ergo node will print a lot of debugging information. This can be disabled by editing the `logback.xml` in `src/main/resources` and recompiling (or editing the XML file inside the jar directly). The following sections need to be edited:

```
<root level="WARN"> <!-- other options are TRACE, ERROR -->
   <appender-ref ref="STDOUT"/> <!-- remove this line to disable all printing -->
   <appender-ref ref="FILE"/>
</root>
```

It is also possible to set desired parameters when running a node, as in: 
   
   `java -jar ergo-assembly-<version>.jar ergo.conf -Dlogback.stdout.level=ERROR`
